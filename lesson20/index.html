<!DOCTYPE html>
<html>
<head>
  <title> </title>
  <style>
    th { cursor: pointer; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
</head>
<body>
  <h2>underscores.js - Collection functions: _.indexBy</h2>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th id="thAge">Age</th>
        <th id="thCity">City</th>
        <th id ="thGender">Gender</th>
      </tr>
    </thead>
    <tbody>
      <tr id="bsmith">
        <td>Bob Smith</td>
        <td>42</td>
        <td>Atlanta</td>
        <td>Male</td>
      </tr>
      <tr id="tjones">
        <td>Trey Jones</td>
        <td>26</td>
        <td>Dublin</td>
        <td>Male</td>
      <tr id="plee">
        <td>Phil Lee</td>
        <td>47</td>
        <td>San Diego</td>
        <td>Male</td>
      </tr>
      <tr id="mtaylor">
        <td>Matt Taylor</td>
        <td>32</td>
        <td>Bangkok</td>
        <td>Male</td>
      </tr>
      <tr id="sjames">
        <td>Susan James</td>
        <td>34</td>
        <td>Atlanta</td>
        <td>Female</td>
      </tr>
      <tr id="cpeters">
        <td>Cynthia Peters</td>
        <td>24</td>
        <td>San Diego</td>
        <td>Female</td>
      </tr>
    </tbody>
  </table>
  <script>

    (function ( document ) {

      "use strict";

      /* _.indexBy(list, iteratee, [context]) 
       Given a list, and an iteratee function that returns a key for each element in the list (or a property name), returns an object with an index of each item. Just like groupBy, but for when you know your keys are unique. .*/
       
      var people = _.map( getAllRows(), function( row ) {
        return {
          id: row.id,
          name: row.childNodes[1].textContent,
          age: row.childNodes[3].textContent,
          city: row.childNodes[5].textContent,
          gender: row.childNodes[7].textContent
        };
      });
      
      var indexedPeople = _.indexBy( people, 
        function( person, index, originalPeople ) {
          return person.id;
      });
      
      console.log ("\tusing _.indexBy(  )...", indexedPeople, "\n");

      // helper functions

      function getAllRows() {
        var childNodes = getFirstNodeByTagName("tbody").childNodes;
        return _.filter( childNodes, function(item) {
          return item.tagName === "TR";
        });
      }

      function getFirstNodeByTagName( tagName ) {
        return _.first( document.getElementsByTagName ( tagName ));
      }

    })( document );
  </script>
</body>
</html>
